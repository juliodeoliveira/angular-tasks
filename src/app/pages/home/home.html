<div class="todo-container">
  <div class="content-container">
    <!-- Input para criar nova pasta -->
    <div class="folder-name">
      <li>
        <input
          type="text"
          placeholder="Create a new folder"
          [(ngModel)]="newFolder"
          (keydown.enter)="addFolder(newFolder)"
          name="newFolder"
          class="folder-input"
        />
        <button class="add-folder" type="button" (click)="addFolder(newFolder)"> + </button>
      </li>
    </div>

    <!-- Abas horizontais -->
    <div class="tabs">
      <div
        class="tab"
        *ngFor="let folder of tasks | keyvalue: originalOrder"
        (click)="openFolder = folder.key"
        [class.active]="openFolder === folder.key"
      >
        <span>{{ folder.key }}</span>
        <button
          class="danger"
          (click)="deleteFolder(folder.key); $event.stopPropagation()"
        >
          🗑️
        </button>
      </div>
    </div>

    <!-- Área fixa para tarefas -->
    <div class="tasks-area" *ngIf="openFolder">
      <ul>
        <li
          class="tasks"
          *ngFor="let task of tasks[openFolder] | keyvalue: originalOrder"
        >
          <!-- Emoji/status atual -->
          <span class="status-emoji">{{ getStatusEmoji(task.value.status) }}</span>

          <!-- Nome da tarefa -->
          <span class="task-name">{{ task.key }}</span>

          <!-- Dropdown estilo select -->
          <div class="dropdown status-select">
            <button
              type="button"
              class="select-toggle"
              (click)="toggleDropdown(openFolder, task.key)"
              aria-haspopup="listbox"
              [attr.aria-expanded]="
                openDropdown?.folder === openFolder &&
                openDropdown?.task === task.key
              "
              title="Alterar status"
            >
              <span class="chevron">▼</span>
            </button>

            <ul
              *ngIf="
                openDropdown?.folder === openFolder &&
                openDropdown?.task === task.key
              "
              class="dropdown-menu"
              role="listbox"
            >
              <li
                *ngFor="let status of statuses"
                role="option"
                tabindex="0"
                (click)="onStatusChange(openFolder, task.key, status.value)"
                class="option"
                style="padding-left: 34px;"
              >
                <span class="opt-icon">{{ status.icon }}</span>
                <span class="opt-label">{{ status.label }}</span>
              </li>

              <li
                class="danger option"
                role="option"
                tabindex="0"
                (click)="deleteTask(openFolder, task.key); openDropdown = null"
                style="padding-left: 34px;"
              >
                <span class="opt-icon">🗑️</span>
                <span class="opt-label">Apagar</span>
              </li>
            </ul>
          </div>
        </li>

        <!-- Input para adicionar nova tarefa -->
        <li class="add-task-input">
          <input
            type="text"
            placeholder="Nova tarefa"
            [(ngModel)]="newTask"
            name="newTask_{{ openFolder }}"
            (keydown.enter)="addTask(openFolder, newTask)"
            class="add-task"
          />
          <button type="button" (click)="addTask(openFolder, newTask)">
            Adicionar
          </button>
        </li>
      </ul>
    </div>
  </div>
</div>
